# GBA_Chess_Engine

## Brief Summary
A Chess engine written entirely by me (yes, even the static library in root/lib!
You can find the source code for it at this
[repo](https://github.com/bsumner2/GBA_Dev)!)

## Project Status

### Features so Far

After months of incremental bursts of progress, I finally have completed a bulk
of the game:
- Title screen two choose between gameplay modes
- Gameplay
    - Local two Payer (Person x Person)
    - Singleplayer
        - Person x CPU
        - CPU x person
- (White|Black) Victory Screen & Stalemate Screen
- Loopability of gameplay
- CPU Engine Features (requires recompilation with predefs.
  **(see specific Makefile predef commands, for each optional feature listed
  here, in Optional Feature Makefile Predefs subsection of README's 
  Build/Testing Tools section)**
    - Engine Analysis Features
        - Engine Decision Tree Visualizer
        - Decision Tree Traversal using GBA Keypad to step through DFS traversal
        - Engine Move Options Visualizer: Similar to Decision Tree Visualizer,
          with only diff being that it only highlights the move choices for
          AI's current turn, but not any of the follow up move analysis.
    - Engine Behaviour Features
        - Change maximum depth of Engine's decision tree
- Saves Game Move History, in a PGN-adjacent format.
    - The Save data is raw binary, so not human-readable ASCII; however...
        - Current Temporary Solution: There is a program in project folder, 
          debug_tools/bin, called Decode_Save_File.elf, which can decode the
          save file (file ext .sav) generated by both GBA emulators (like MGBA
          and VBA) and Flash Cartridges (like EZ Flash and Everdrive) alike!
          **(See details for how to run the Save Data decoder in Save File
          Decoder subsection of README's Build/Testing Tools section)).**
        - Planned Permanent Solution: Going to add features for Choosing to
          save games, instead of saving them every time regardless of user
          choice *(currently done this way for debug purposes)*. Will also add
          feature for loading saved games to either resume unfinished games
          or review finished games.

### Issues

There are a few assertions that fail under rare circumstances, and it's getting
difficult to track them down, but it seems at least one of them may be caused
by heap fragmentation, and others may be simple discrepancies between what
AI's board state tracker, BoardState_t, believes current game state is, and what
Front End's board state tracker, ChessGameCtx_t believes current game state is.


### Gameplay Footage

Below is a GIF of the game compiled with The CPU Engine movement visualizer
setting.

![alt text](/demo/GBA_Chess_Engine_Screenrecording1.gif "Gameplay of title screen + gameplay w/ engine decision tree visualizer")

Below is a GIF of the game running with a custom CPU maximum depth, 
of MAX_DEPTH=1, and Engine analysis features turned off. 
Max depth is the fastest, but it isn't the sharpest tool in the shed. Engine
only starts getting smart at MAX_DEPTH=3


![alt text](/demo/GBA_Chess_Engine_Screenrecording0.gif "Gameplay of title screen + gameplay w/ CPU Max Depth=1 and Analysis turned off")

## Build/Testing Tools

### Optional Feature Makefile Predefs

#### Engine Decision Visualizer Predef:

Predefine this feature with preprocessor macro *_AI_VISUALIZE_MOVE_SEARCH_TRAVERSAL_*
e.g.:

```shell
$ make clean build MACROS="-D_AI_VISUALIZE_MOVE_SEARCH_TRAVERSAL_"
```

#### CPU Opponent Engine Decision Tree Traversal via Keypad

Predefine this feature with preprocessor macro *_DEBUG_BUILD_*
e.g.:

```shell
$ make clean build MACROS="-D_DEBUG_BUILD_"
```

The Makefile's debug & gbuild *(the g in this context refers to GCC debug flag,
-g)* recipes automatically adds -D_DEBUG_BUILD_ to CFLAGS, so no need to
specify it again with custom MACROS Makefile var decl.
e.g.:

```shell
$ make clean debug
# Or
$ make clean gbuild
```

##### Override Keypad-Stepped Traversal for Automated Traversal Animation

If you want to debug, but dont want to have to keep pressing A on the keypad
to step through AI's decision tree traversal, you can override that setting
with -D_DEBUG_OVERRIDE_KSYNC_.
e.g.:

```shell
$ make clean debug MACROS="-D_DEBUG_OVERRIDE_KSYNC_"
# Or
$ make clean gbuild MACROS="-D_DEBUG_OVERRIDE_KSYNC_"
```

#### Custom Max Depth

Predefine this feature with preprocessor macro *MAX_DEPTH=<max depth number>*
e.g.:

```shell
$ make clean build MACROS="-DMAX_DEPTH=4"
```

#### Engine Move Options Visualizer

Predefine this feature with preprocessor macro *_AI_VISUALIZE_MOVE_CANDIDATES_*

```shell
$ make clean build MACROS="-D_AI_VISUALIZE_MOVE_CANDIDATES_"
```

#### Mix and match features with build var predef for MACROS:

- *MAX_DEPTH* macro can be mixed and match with any other macros
- *_AI_VISUALIZE_MOVE_CANDIDATES_* and *_AI_VISUALIZE_MOVE_SEARCH_TRAVERSAL_* 
  are mutually exclusive, meaning you can't enable both. Only one or the other.
- *_DEBUG_BUILD_* macro automatically enables 
  *_AI_VISUALIZE_MOVE_SEARCH_TRAVERSAL_*, and cannot choose *_DEBUG_BUILD_*
  with *_AI_VISUALIZE_MOVE_CANDIDATES_*, which is incompatible with 
  *_AI_VISUALIZE_MOVE_SEARCH_TRAVERSAL_*

So basically, MAX_DEPTH is compatible with any other feature, but the rest 
should be treated as mutually exclusive. In the future, I'm gonna add a 
feature to let these all be available in-game, and features can be configured
during runtime.

##### Examples:

Enable Stepwise Decision Tree Traversal and set custom max depth of 4

```shell
$ make clean build MACROS="-DMAX_DEPTH=4 -D_DEBUG_BUILD_"
```

### Save File Decoder

The decoder is located in ./debug_tools/bin and is named Decode_Save_File.elf.
It is an ELF, so it's a Linux executable, but I plan on making an EXE if anyone
brings it up in the repo's Issues tab. To decode a save file, just run the 
following command:

```shell
$ ./debug_tools/bin/Decode_Save_File.elf <save file path>
```

Typically, if you're just running the game directly from bin folder,
emulators will simply generate the save file in the same folder, using the
GBA ROM file's basename, as the save file's basename. The project root dir's
name is what the Makefile uses as the basename for the generated .gba ROM file,
which is **GBA_Chess_Engine** by default, so in this scenario you would just
use ./bin/GBA_Chess_Engine.sav as the *<save file path>* arg.
e.g.:

```shell
$ ./debug_tools/bin/Decode_Save_File.elf ./bin/GBA_Chess_Engine.sav
```

These instructions will also be offered by the program whenever invalid, or an
unexpected number of, command args are offered. Running the program with no
other args is an easy way to pull up this help dialogue.
e.g.:

```shell
# Cmd below will print help dialogue.
$ ./debug_tools/bin/Decode_Save_File.elf
```
